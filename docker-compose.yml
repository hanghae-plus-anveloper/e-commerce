version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: hhplus-mysql
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_USER: application
      MYSQL_PASSWORD: application
      MYSQL_DATABASE: hhplus
    command:
      --max_connections=1000
      --innodb_buffer_pool_size=2G
      --innodb_log_file_size=512M
      --innodb_flush_log_at_trx_commit=2
      --innodb_flush_method=O_DIRECT
      --innodb_thread_concurrency=0
      --innodb_read_io_threads=8
      --innodb_write_io_threads=8
      --performance_schema=OFF
      --skip-name-resolve
    volumes:
      - ./data/mysql:/var/lib/mysql
    networks:
      - hhplus-network
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: "2.0"
          memory: 4g
        reservations:
          cpus: "1.0"
          memory: 2g

volumes:
  mysql_data:

networks:
  hhplus-network:
    driver: bridge
