# E-commerce Performance Scenario K6

## 성능 테스트 시나리오

### 시나리오 개요

- 동시 최대 200명의 사용자가 핵심 플로우를 수행하는 동안의 성능 및 안정성을 검증함을 목적으로함.
- 핵심 플로우는 잔액 충전 → 한정 수량에 대한 쿠폰 발급 시도 → 여러 상품을 한번에 구매 순으로 진행함.
- 잔액 충전은 각자 정상적으로 충전이 되며, 쿠폰 발급은 200개의 요청 중 100건만 성공하고, 쿠폰 사용을 포함하여 200건의 주문이 생성되어야 함.

### 페르소나 지정

#### 페르소나 A 유형 - 충동 구매형 소비 패턴

- 배경
  - 쿠폰 이벤트를 보면 반드시 참여하려는 성향
  - 남들이 다 있는 상품은 무조건 구매하는 성향
  - 광고에 취약해, 충동적인 구매를 하는 사용자를 모티브로 페르소나 지정
- 행동 단계
  - 상품 1~5번을 모두 구매할 수 있는 충분한 금액을 충전함
  - 충전이 완료되면 발급받은 사용자 ID를 기반으로 할인 쿠폰 발행을 시도함
  - 쿠폰 발급 성공 여부에 관계 없이 주문을 시도함
  - 쿠폰 ID를 포함하여, 상품은 3일 간 가장 많이 판매된 TOP5를 각 1개씩 구매함
  - 주문에 성공하면, 최종적으로 남은 잔액을 확인함
- 테스트 포인트
  - 잔액 충전 성공 100% 
  - 쿠폰 발급 여부에 관계 없이 주문을 시도 
  - 상품 5개가 담긴 주문 생성

#### 페르소나 B 유형 - 합리적 소비 패턴

- 배경
  - 쿠폰 유무에 따른 합리적인 소비를 하려는 성향
  - 원래 구매하려던 상품 1개 외에 쿠폰 유무에 따라 추가 상품 1개를 더 구매
  - 할인, 1+1 이벤트 등, 소비를 하되 합리적인 소비를 목적으로 하는 사용자를 모티브로 페르소나 지정
- 행동 단계
  - 상품 1번을 구매할 수 있는 금액을 충전함
  - 충전이 완료되면 발급된 사용자 ID를 기반으로 할인 쿠폰 발행을 시도함
  - 쿠폰 발급 유무에 따라, 할인금액에 맞춰 상품 2번을 추가로 주문하거나, 원래 구매하려는 1번만 구매함
  - 최종적으로 남은 잔액을 확인하여 0원인 지 확인함
- 테스트 포인트 
  - 잔액 충전 성공 100%
  - 쿠폰 발급 여부에 따라 상품 변동
  - 최종적으로 잔액을 모두 소비

#### 페르소나 C 유형 - 악의적인 주문 시도 패턴

- 배경
  - 평소 서비스의 취약점을 노려 악의적인 주문을 시도함
  - 발급되지 않는 쿠폰을 사용하여 주문을 시도함
  - 쿠폰이 발급되었다면, 쿠폰을 동시에 두번 사용하려고 시도함
- 행동 단계
  - 충분하지 않은 금액 충전
  - 쿠폰 발급 시도
  - 발급되었다면 중복 사용 시도, 발급되지 않았어도 무작위 요청 시도
- 테스트 포인트
  - 전 구간에서 실패하여 주문이 발생하지 않아야 함

### 전체 성능 테스트 체크 항목

- 각 유형별 100건의 사용자가 잔액 충전을 통해 ID을 발급 받아 300건의 사용자 테이블이 생성 되는 지 확인
- 모두 쿠폰 발급 시도를 하되, 100개의 쿠폰만 발급이 되는 지 확인, 유형별 쿠폰에 따라 일부 주문 정보가 달라지는 지 확인
- 주문 생성의 시도는 각 유형별 100건을 시도하되, 정상적으로 구매를 하는 200건만 성공
- 사용된 잔액이 예측했던 금액인 지 확인
- 테스트 결과에 따라 각 유형 100명에 대한 가상 사용자 수 조정

## K6 환경 세팅

###

```bash
docker-compose -f docker-compose-k6.yml run --rm k6 \
  run --out influxdb=http://k6:k6pass@influxdb:8086/k6 \
  /scripts/test.js
```